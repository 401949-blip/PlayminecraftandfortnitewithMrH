<!DOCTYPE html>
<html>
<head>
<title>dont play this in class if you do youre not cool</title>
<meta charset="UTF-8">

<style>
body{
  margin:0;
  overflow:hidden;
  background:#0b0b0b;
  font-family:Courier, monospace;
}

#game{
  position:relative;
  width:100vw;
  height:100vh;
  background:
    linear-gradient(rgba(255,255,255,.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,.03) 1px, transparent 1px);
  background-size:40px 40px;
}

#player{
  position:absolute;
  width:60px;
  height:60px;
  image-rendering:pixelated;
  filter:drop-shadow(0 0 12px white);
  transition:width .1s, height .1s;
}

.orb{
  position:absolute;
  width:22px;
  height:22px;
  background:#00f0ff;
  box-shadow:0 0 20px #00f0ff;
}

.enemy{
  position:absolute;
  width:32px;
  height:32px;
  background:#ff2a2a;
  box-shadow:0 0 15px red;
}

.power{
  position:absolute;
  width:40px;
  height:40px;
  background:gold;
  box-shadow:0 0 25px gold;
}

.kirk{
  position:absolute;
  width:40px;
  height:40px;
  background:#8000ff;
  box-shadow:0 0 25px #8000ff;
}

#ui{
  position:absolute;
  top:12px;
  left:12px;
  color:white;
  background:rgba(0,0,0,.6);
  padding:10px 14px;
  border-radius:8px;
}

#playAgain{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  padding:16px 36px;
  display:none;
  background:black;
  color:white;
  border:2px solid white;
  cursor:pointer;
}
</style>
</head>
<body>

<div id="game" tabindex="0">
  <div id="ui">
    Score: <span id="score">0</span><br>
    Speed: <span id="spd">64</span>
  </div>
  <button id="playAgain" onclick="location.reload()">PLAY AGAIN</button>
  <img src="hathaway.jpeg" id="player">
</div>

<script>
const game = document.getElementById("game");
const player = document.getElementById("player");
const scoreEl = document.getElementById("score");
const spdEl = document.getElementById("spd");
const playBtn = document.getElementById("playAgain");

game.focus(); // force keyboard focus

let x = window.innerWidth/2;
let y = window.innerHeight/2;

let velX = 0;
let velY = 0;

let speed = 64;
let acceleration = 3;
let friction = 0.88;

let enemySpeed = 2.5;
let score = 0;
let invincible = false;
let gameOver = false;

let keys = {};

document.addEventListener("keydown", e=>{
  keys[e.key] = true;
  if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"," "].includes(e.key)){
    e.preventDefault();
  }
});

document.addEventListener("keyup", e=>{
  keys[e.key] = false;
});

function spawn(cls){
  const d = document.createElement("div");
  d.className = cls;
  d.style.left = Math.random()*(window.innerWidth-50)+"px";
  d.style.top = Math.random()*(window.innerHeight-50)+"px";
  game.appendChild(d);
}

function collide(a,b){
  const A=a.getBoundingClientRect();
  const B=b.getBoundingClientRect();
  return !(A.right<B.left||A.left>B.right||A.bottom<B.top||A.top>B.bottom);
}

function devito(){
  document.querySelectorAll(".enemy").forEach(e=>e.remove());

  const img=document.createElement("img");
  img.src="devito.jpeg";
  img.style.position="absolute";
  img.style.width="320px";
  img.style.left=(window.innerWidth/2-160)+"px";
  img.style.top=(window.innerHeight/2-160)+"px";
  img.style.filter="drop-shadow(0 0 30px gold)";
  game.appendChild(img);

  setTimeout(()=>img.remove(),1000);
}

function kirk(){
  invincible=true;
  score+=50;
  speed+=50;

  scoreEl.textContent=score;
  spdEl.textContent=speed;

  const img=document.createElement("img");
  img.src="kirk.jpeg";
  img.style.position="absolute";
  img.style.width="100vw";
  img.style.height="100vh";
  img.style.top=0;
  img.style.left=0;
  game.appendChild(img);

  for(let i=0;i<50;i++) spawn("enemy");

  setTimeout(()=>img.remove(),1200);
  setTimeout(()=>invincible=false,5000);
}

function death(){
  gameOver=true;
  player.style.opacity="0";

  for(let i=0;i<60;i++){
    const p=document.createElement("div");
    p.style.position="absolute";
    p.style.width="5px";
    p.style.height="5px";
    p.style.background="white";
    p.style.left=x+"px";
    p.style.top=y+"px";
    game.appendChild(p);

    const ang=Math.random()*Math.PI*2;
    const v=Math.random()*7+2;
    let px=0, py=0;

    function anim(){
      px+=Math.cos(ang)*v;
      py+=Math.sin(ang)*v;
      p.style.transform=`translate(${px}px,${py}px)`;
      p.style.opacity-=0.03;
      if(p.style.opacity<=0)p.remove();
      else requestAnimationFrame(anim);
    }
    p.style.opacity=1;
    anim();
  }

  setTimeout(()=>playBtn.style.display="block",800);
}

function loop(){
  if(gameOver) return;

  if(keys["ArrowUp"]||keys["w"]) velY -= acceleration;
  if(keys["ArrowDown"]||keys["s"]) velY += acceleration;
  if(keys["ArrowLeft"]||keys["a"]) velX -= acceleration;
  if(keys["ArrowRight"]||keys["d"]) velX += acceleration;

  let mag = Math.sqrt(velX*velX+velY*velY);
  if(mag > speed){
    velX = (velX/mag)*speed;
    velY = (velY/mag)*speed;
  }

  velX *= friction;
  velY *= friction;

  x += velX;
  y += velY;

  if(x>window.innerWidth) x=0;
  if(x<0) x=window.innerWidth;
  if(y>window.innerHeight) y=0;
  if(y<0) y=window.innerHeight;

  player.style.left=x+"px";
  player.style.top=y+"px";

  document.querySelectorAll(".enemy").forEach(e=>{
    let ex=parseFloat(e.style.left);
    let ey=parseFloat(e.style.top);

    let dx=x-ex;
    let dy=y-ey;
    let dist=Math.sqrt(dx*dx+dy*dy);

    ex+=(dx/dist)*enemySpeed;
    ey+=(dy/dist)*enemySpeed;

    e.style.left=ex+"px";
    e.style.top=ey+"px";

    if(!invincible && collide(player,e)) death();
  });

  document.querySelectorAll(".orb").forEach(o=>{
    if(collide(player,o)){
      o.remove();
      score++;
      speed+=5;
      enemySpeed+=.25;
      scoreEl.textContent=score;
      spdEl.textContent=speed;
      spawn("orb");
    }
  });

  document.querySelectorAll(".power").forEach(p=>{
    if(collide(player,p)){ p.remove(); devito(); }
  });

  document.querySelectorAll(".kirk").forEach(k=>{
    if(collide(player,k)){ k.remove(); kirk(); }
  });

  requestAnimationFrame(loop);
}

spawn("orb");
setInterval(()=>spawn("enemy"),1400);
setInterval(()=>spawn("power"),12000);
setInterval(()=>spawn("kirk"),20000);

loop();
</script>
</body>
</html>
