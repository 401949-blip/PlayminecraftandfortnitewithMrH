<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Do Your Work</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  background: #0b0b0b;
  font-family: Courier, monospace;
}

#start {
  position: fixed;
  inset: 0;
  background: url('ocean.jpeg') center / cover no-repeat;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 20000;
}

#start h1 {
  margin: 0;
  font-size: clamp(3rem, 8vw, 5rem);
  color: black;
  text-shadow: 2px 2px 5px rgba(255, 255, 255, 0.7);
  font-family: Arial, sans-serif;
  font-weight: 700;
}

#startO {
  display: inline-block;
  cursor: pointer;
  text-decoration: none;
}

#game {
  position: relative;
  width: 100vw;
  height: 100vh;
  display: none;
  background:
    linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
  background-size: 40px 40px;
}

#player {
  position: absolute;
  width: 60px;
  height: 60px;
  image-rendering: pixelated;
  filter: drop-shadow(0 0 12px white);
  transition: width 0.1s, height 0.1s;
}

.orb {
  position: absolute;
  width: 22px;
  height: 22px;
  background: #00f0ff;
  box-shadow: 0 0 20px #00f0ff;
  border-radius: 4px;
}

.enemy {
  position: absolute;
  width: 32px;
  height: 32px;
  background: #ff2a2a;
  box-shadow: 0 0 15px red;
  border-radius: 6px;
}

.power {
  position: absolute;
  width: 40px;
  height: 40px;
  background: gold;
  box-shadow: 0 0 25px gold;
  border-radius: 6px;
}

.kirk {
  position: absolute;
  width: 40px;
  height: 40px;
  background: #8000ff;
  box-shadow: 0 0 25px #8000ff;
  border-radius: 6px;
}

.boss {
  position: absolute;
  width: 120px;
  height: 120px;
  border-radius: 14px;
  object-fit: cover;
  image-rendering: pixelated;
  filter: saturate(1.2) contrast(1.15) drop-shadow(0 0 18px rgba(255, 60, 60, 0.95));
  z-index: 9000;
}

.boss-bullet {
  position: absolute;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: radial-gradient(circle at 35% 35%, #ffd7d7, #ff2d2d 62%, #840b0b);
  box-shadow: 0 0 16px rgba(255, 55, 55, 0.9);
  z-index: 8990;
}

#ui {
  position: absolute;
  top: 12px;
  left: 12px;
  color: white;
  background: rgba(0, 0, 0, 0.6);
  padding: 10px 14px;
  border-radius: 8px;
}

#bossUI {
  position: absolute;
  top: 12px;
  left: 50%;
  transform: translateX(-50%);
  width: min(520px, 84vw);
  color: #ffe7e7;
  background: rgba(0, 0, 0, 0.72);
  border: 1px solid rgba(255, 110, 110, 0.45);
  border-radius: 8px;
  padding: 8px 10px;
  display: none;
  z-index: 12000;
}

#bossTop {
  display: flex;
  justify-content: space-between;
  font-size: 0.9rem;
  margin-bottom: 6px;
}

#bossBar {
  width: 100%;
  height: 12px;
  border-radius: 999px;
  overflow: hidden;
  background: rgba(255, 255, 255, 0.14);
}

#bossFill {
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, #ff8c8c, #ff2e2e);
  box-shadow: 0 0 10px rgba(255, 70, 70, 0.8);
  transition: width 0.18s linear;
}

#game.boss-mode {
  filter: contrast(1.08) saturate(1.12);
}

#bossAmbience {
  position: absolute;
  inset: 0;
  pointer-events: none;
  display: none;
  z-index: 8500;
  background:
    radial-gradient(circle at 50% 50%, rgba(255, 22, 22, 0.12), rgba(0, 0, 0, 0) 55%),
    linear-gradient(180deg, rgba(20, 0, 0, 0.3), rgba(0, 0, 0, 0.18));
  animation: bossPulse 2.4s ease-in-out infinite;
}

@keyframes bossPulse {
  0% { opacity: 0.45; }
  50% { opacity: 0.8; }
  100% { opacity: 0.45; }
}

#playAgain {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: 16px 36px;
  display: none;
  background: black;
  color: white;
  border: 2px solid white;
  cursor: pointer;
}
</style>
</head>
<body>
<div id="start">
  <h1>Do your w<span id="startO" title="Start game">o</span>rk</h1>
</div>

<div id="game" tabindex="0">
  <div id="ui">
    Score: <span id="score">0</span><br>
    Speed: <span id="spd">18.0</span>
  </div>
  <div id="bossUI">
    <div id="bossTop">
      <span id="bossName">EVIL HATHAWAY</span>
      <span id="bossHpText">100%</span>
    </div>
    <div id="bossBar"><div id="bossFill"></div></div>
  </div>
  <div id="bossAmbience"></div>
  <button id="playAgain">PLAY AGAIN</button>
  <img src="hathaway.jpeg" id="player" alt="player">
</div>

<script>
const INTRO_KEY = "doYourWorkSeen";
const ENEMY_SAFE_RADIUS = 240;

const startScreen = document.getElementById("start");
const startO = document.getElementById("startO");
const game = document.getElementById("game");
const player = document.getElementById("player");
const scoreEl = document.getElementById("score");
const spdEl = document.getElementById("spd");
const playBtn = document.getElementById("playAgain");
const bossUI = document.getElementById("bossUI");
const bossFill = document.getElementById("bossFill");
const bossHpText = document.getElementById("bossHpText");
const bossAmbience = document.getElementById("bossAmbience");

let x = window.innerWidth / 2;
let y = window.innerHeight / 2;
let velX = 0;
let velY = 0;
let speed = 18;
let acceleration = 1.2;
let friction = 0.9;
let enemySpeed = 0.6;
let score = 0;
let invincible = false;
let gameOver = false;
let cutsceneActive = false;
let keys = {};
let gameStarted = false;

let enemyTimer;
let powerTimer;
let kirkTimer;
let pacingTimer;
let bossMinionTimer;
let bossBulletTimer;
let bossOrbTimer;

let nextBossAt = 0;
let bossActive = false;
let bossEl = null;
let bossX = 0;
let bossY = 0;
let bossVx = 0;
let bossVy = 0;
let bossDashFrames = 0;
let bossDashCooldown = 180;
let bossHp = 0;
let bossMaxHp = 0;

document.addEventListener("keydown", e => {
  keys[e.key] = true;
  if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].includes(e.key)) {
    e.preventDefault();
  }
});

document.addEventListener("keyup", e => {
  keys[e.key] = false;
});

playBtn.addEventListener("click", restartGame);

function clearTimers() {
  clearInterval(enemyTimer);
  clearInterval(powerTimer);
  clearInterval(kirkTimer);
  clearInterval(pacingTimer);
  clearInterval(bossMinionTimer);
  clearInterval(bossBulletTimer);
  clearInterval(bossOrbTimer);
}

function startTimers() {
  enemyTimer = setInterval(() => spawn("enemy"), 2200);
  powerTimer = setInterval(() => spawn("power"), 16000);
  kirkTimer = setInterval(() => spawn("kirk"), 26000);

  // Slow long-term ramp so the game takes a while to get intense.
  pacingTimer = setInterval(() => {
    if (gameOver || cutsceneActive) return;
    speed = Math.min(speed + 0.35, 70);
    enemySpeed = Math.min(enemySpeed + 0.05, 4.5);
    spdEl.textContent = speed.toFixed(1);
  }, 5000);
}

function clearDynamicObjects() {
  document.querySelectorAll(".orb,.enemy,.power,.kirk,.cutscene-overlay,.boss,.boss-bullet").forEach(el => el.remove());
}

function scheduleNextBoss() {
  nextBossAt = Date.now() + 90000 + Math.random() * 45000;
}

function resetState() {
  clearTimers();
  clearDynamicObjects();

  x = window.innerWidth / 2;
  y = window.innerHeight / 2;
  velX = 0;
  velY = 0;
  speed = 18;
  acceleration = 1.2;
  friction = 0.9;
  enemySpeed = 0.6;
  score = 0;
  invincible = false;
  gameOver = false;
  cutsceneActive = false;
  keys = {};
  scheduleNextBoss();
  bossActive = false;
  bossEl = null;
  bossX = 0;
  bossY = 0;
  bossVx = 0;
  bossVy = 0;
  bossDashFrames = 0;
  bossDashCooldown = 180;
  bossHp = 0;
  bossMaxHp = 0;

  scoreEl.textContent = String(score);
  spdEl.textContent = speed.toFixed(1);
  player.style.opacity = "1";
  player.style.left = x + "px";
  player.style.top = y + "px";
  playBtn.style.display = "none";
  bossUI.style.display = "none";
  bossFill.style.width = "100%";
  bossHpText.textContent = "100%";
  bossAmbience.style.display = "none";
  game.classList.remove("boss-mode");
}

function restartGame() {
  resetState();
  spawn("orb");
  startTimers();
  game.focus();
  requestAnimationFrame(loop);
}

function spawn(cls) {
  const d = document.createElement("div");
  d.className = cls;

  let sx = 0;
  let sy = 0;
  const maxAttempts = 60;

  for (let i = 0; i < maxAttempts; i++) {
    sx = Math.random() * (window.innerWidth - 50);
    sy = Math.random() * (window.innerHeight - 50);

    if (cls !== "enemy") break;

    const dx = (sx + 16) - x;
    const dy = (sy + 16) - y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if (dist >= ENEMY_SAFE_RADIUS) break;
  }

  d.style.left = sx + "px";
  d.style.top = sy + "px";
  game.appendChild(d);
  return d;
}

function spawnEnemyNearBoss() {
  if (!bossActive || !bossEl) return;
  const e = document.createElement("div");
  e.className = "enemy";
  const ang = Math.random() * Math.PI * 2;
  const r = 140 + Math.random() * 120;
  let sx = bossX + Math.cos(ang) * r;
  let sy = bossY + Math.sin(ang) * r;
  sx = Math.max(10, Math.min(window.innerWidth - 42, sx));
  sy = Math.max(10, Math.min(window.innerHeight - 42, sy));
  const dx = sx - x;
  const dy = sy - y;
  const d = Math.sqrt(dx * dx + dy * dy);
  if (d < ENEMY_SAFE_RADIUS * 0.8) {
    sx = x + (dx / (d || 1)) * ENEMY_SAFE_RADIUS * 0.8;
    sy = y + (dy / (d || 1)) * ENEMY_SAFE_RADIUS * 0.8;
  }
  e.style.left = sx + "px";
  e.style.top = sy + "px";
  game.appendChild(e);
}

function spawnBossBullet() {
  if (!bossActive || !bossEl) return;
  const b = document.createElement("div");
  b.className = "boss-bullet";
  const bx = bossX + 60;
  const by = bossY + 60;
  const dx = x - bx;
  const dy = y - by;
  const dist = Math.sqrt(dx * dx + dy * dy) || 1;
  const bv = 4.3;
  b.dataset.vx = ((dx / dist) * bv).toString();
  b.dataset.vy = ((dy / dist) * bv).toString();
  b.style.left = (bx - 9) + "px";
  b.style.top = (by - 9) + "px";
  game.appendChild(b);
}

function updateBossUI() {
  if (!bossActive) return;
  const pct = Math.max(0, Math.round((bossHp / bossMaxHp) * 100));
  bossFill.style.width = pct + "%";
  bossHpText.textContent = pct + "%";
}

function beginBossPhase() {
  clearInterval(enemyTimer);
  clearInterval(powerTimer);
  clearInterval(kirkTimer);

  document.querySelectorAll(".enemy,.power,.kirk").forEach(el => el.remove());
  document.querySelectorAll(".orb").forEach(el => el.remove());

  bossMaxHp = 34;
  bossHp = bossMaxHp;
  bossX = Math.random() * (window.innerWidth - 160) + 20;
  bossY = 20;
  bossDashFrames = 0;
  bossDashCooldown = 120;
  bossVx = 0;
  bossVy = 0;

  bossEl = document.createElement("img");
  bossEl.src = "hathaway.jpeg";
  bossEl.className = "boss";
  bossEl.style.left = bossX + "px";
  bossEl.style.top = bossY + "px";
  game.appendChild(bossEl);

  bossUI.style.display = "block";
  bossAmbience.style.display = "block";
  game.classList.add("boss-mode");
  updateBossUI();

  for (let i = 0; i < 6; i++) spawn("orb");

  bossMinionTimer = setInterval(() => {
    if (!bossActive || gameOver) return;
    spawnEnemyNearBoss();
    if (Math.random() < 0.55) spawnEnemyNearBoss();
  }, 3300);

  bossBulletTimer = setInterval(() => {
    if (!bossActive || gameOver) return;
    spawnBossBullet();
    if (Math.random() < 0.35) {
      setTimeout(() => spawnBossBullet(), 180);
    }
  }, 1350);

  bossOrbTimer = setInterval(() => {
    if (!bossActive || gameOver) return;
    if (document.querySelectorAll(".orb").length < 9) spawn("orb");
  }, 900);
}

function startBossIntro() {
  cutsceneActive = true;
  invincible = true;

  const overlay = document.createElement("div");
  overlay.className = "cutscene-overlay";
  overlay.style.position = "absolute";
  overlay.style.inset = "0";
  overlay.style.zIndex = "13000";
  overlay.style.opacity = "0";
  overlay.style.transition = "opacity 500ms ease";
  overlay.style.background = "radial-gradient(circle at center, rgba(140,0,0,0.5) 0%, rgba(0,0,0,0.95) 70%)";
  overlay.style.overflow = "hidden";
  game.appendChild(overlay);

  const warning = document.createElement("div");
  warning.textContent = "EVIL HATHAWAY HAS ARRIVED";
  warning.style.position = "absolute";
  warning.style.top = "18%";
  warning.style.left = "50%";
  warning.style.transform = "translate(-50%, -50%) scale(0.8)";
  warning.style.fontFamily = "monospace";
  warning.style.fontSize = "clamp(20px,4vw,42px)";
  warning.style.letterSpacing = "4px";
  warning.style.color = "#ffd5d5";
  warning.style.textShadow = "0 0 24px rgba(255, 75, 75, 0.9)";
  warning.style.opacity = "0";
  warning.style.transition = "all 700ms ease";
  overlay.appendChild(warning);

  const face = document.createElement("img");
  face.src = "hathaway.jpeg";
  face.style.position = "absolute";
  face.style.left = "50%";
  face.style.top = "56%";
  face.style.width = "300px";
  face.style.height = "300px";
  face.style.objectFit = "cover";
  face.style.borderRadius = "14px";
  face.style.transform = "translate(-50%,-50%) scale(0.45)";
  face.style.filter = "brightness(0.65) contrast(1.2) saturate(1.2) blur(4px)";
  face.style.boxShadow = "0 0 40px rgba(255, 40, 40, 0.75)";
  face.style.transition = "all 1.2s cubic-bezier(.2,.75,.2,1)";
  overlay.appendChild(face);

  const flash = document.createElement("div");
  flash.style.position = "absolute";
  flash.style.inset = "0";
  flash.style.background = "#ffd8d8";
  flash.style.opacity = "0";
  flash.style.transition = "opacity 120ms linear";
  overlay.appendChild(flash);

  setTimeout(() => { overlay.style.opacity = "1"; }, 20);
  setTimeout(() => {
    warning.style.opacity = "1";
    warning.style.transform = "translate(-50%, -50%) scale(1)";
  }, 240);
  setTimeout(() => {
    face.style.transform = "translate(-50%,-50%) scale(1)";
    face.style.filter = "brightness(1.05) contrast(1.26) saturate(1.35) blur(0)";
  }, 450);
  setTimeout(() => {
    flash.style.opacity = "0.95";
    setTimeout(() => { flash.style.opacity = "0"; }, 70);
  }, 1350);
  setTimeout(() => { overlay.style.opacity = "0"; }, 2500);
  setTimeout(() => {
    overlay.remove();
    cutsceneActive = false;
    invincible = false;
    beginBossPhase();
  }, 3050);
}

function startBossFight() {
  if (bossActive || gameOver || cutsceneActive) return;
  clearInterval(enemyTimer);
  clearInterval(powerTimer);
  clearInterval(kirkTimer);
  bossActive = true;
  startBossIntro();
}

function kirkFinisherCutscene() {
  if (!bossActive || !bossEl || cutsceneActive) return;
  cutsceneActive = true;
  invincible = true;
  clearInterval(bossMinionTimer);
  clearInterval(bossBulletTimer);
  clearInterval(bossOrbTimer);

  const rect = bossEl.getBoundingClientRect();
  bossEl.style.opacity = "0";

  const overlay = document.createElement("div");
  overlay.className = "cutscene-overlay";
  overlay.style.position = "absolute";
  overlay.style.inset = "0";
  overlay.style.zIndex = "14000";
  overlay.style.opacity = "0";
  overlay.style.transition = "opacity 350ms ease";
  overlay.style.background = "radial-gradient(circle at center, rgba(24,30,52,0.45) 0%, rgba(0,0,0,0.92) 72%)";
  overlay.style.overflow = "hidden";
  game.appendChild(overlay);

  const label = document.createElement("div");
  label.textContent = "CHARLIE KIRK // HAMMER OF JUDGMENT";
  label.style.position = "absolute";
  label.style.top = "14%";
  label.style.left = "50%";
  label.style.transform = "translate(-50%, -50%)";
  label.style.fontFamily = "monospace";
  label.style.fontSize = "clamp(18px,2.8vw,30px)";
  label.style.letterSpacing = "3px";
  label.style.color = "#c9ffe0";
  label.style.textShadow = "0 0 22px rgba(96,255,178,0.85)";
  overlay.appendChild(label);

  const kirk = document.createElement("img");
  kirk.src = "kirk.jpeg";
  kirk.style.position = "absolute";
  kirk.style.left = "-320px";
  kirk.style.top = Math.max(40, rect.top - 40) + "px";
  kirk.style.width = "300px";
  kirk.style.height = "300px";
  kirk.style.objectFit = "cover";
  kirk.style.borderRadius = "14px";
  kirk.style.filter = "drop-shadow(0 0 28px rgba(150,255,200,0.95))";
  kirk.style.transition = "left 700ms cubic-bezier(.16,.84,.22,1)";
  overlay.appendChild(kirk);

  const hammer = document.createElement("div");
  hammer.style.position = "absolute";
  hammer.style.left = (rect.left + rect.width / 2 - 20) + "px";
  hammer.style.top = (rect.top - 180) + "px";
  hammer.style.width = "40px";
  hammer.style.height = "240px";
  hammer.style.transformOrigin = "20px 220px";
  hammer.style.transform = "rotate(-95deg)";
  hammer.style.background = "linear-gradient(180deg, #5e4a35, #2f2418)";
  hammer.style.borderRadius = "8px";
  hammer.style.boxShadow = "0 0 18px rgba(0,0,0,0.7)";
  hammer.style.transition = "transform 260ms cubic-bezier(.2,.8,.2,1)";
  overlay.appendChild(hammer);

  const head = document.createElement("div");
  head.style.position = "absolute";
  head.style.left = "-44px";
  head.style.top = "-22px";
  head.style.width = "128px";
  head.style.height = "46px";
  head.style.borderRadius = "8px";
  head.style.background = "linear-gradient(90deg, #a8c7d6, #e9f5ff)";
  head.style.boxShadow = "0 0 16px rgba(210,240,255,0.95)";
  hammer.appendChild(head);

  setTimeout(() => { overlay.style.opacity = "1"; }, 20);
  setTimeout(() => { kirk.style.left = (rect.left - 190) + "px"; }, 250);
  setTimeout(() => {
    hammer.style.transform = "rotate(22deg)";
    animeDeathBurst(rect.left + rect.width / 2, rect.top + rect.height / 2, overlay);
  }, 980);
  setTimeout(() => { overlay.style.opacity = "0"; }, 1650);
  setTimeout(() => {
    overlay.remove();
    cutsceneActive = false;
    invincible = false;
    endBossFight(true);
  }, 2050);
}

function endBossFight(victory) {
  clearInterval(bossMinionTimer);
  clearInterval(bossBulletTimer);
  clearInterval(bossOrbTimer);
  bossMinionTimer = undefined;
  bossBulletTimer = undefined;
  bossOrbTimer = undefined;

  if (bossEl) {
    const rect = bossEl.getBoundingClientRect();
    animeDeathBurst(rect.left + rect.width / 2, rect.top + rect.height / 2, game);
    bossEl.remove();
  }
  bossEl = null;
  bossActive = false;
  bossUI.style.display = "none";
  bossAmbience.style.display = "none";
  game.classList.remove("boss-mode");
  document.querySelectorAll(".boss-bullet").forEach(el => el.remove());

  if (victory) {
    score += 250;
    scoreEl.textContent = String(score);
    speed += 7;
    spdEl.textContent = speed.toFixed(1);
  }

  if (!gameOver) {
    enemyTimer = setInterval(() => spawn("enemy"), 2200);
    powerTimer = setInterval(() => spawn("power"), 16000);
    kirkTimer = setInterval(() => spawn("kirk"), 26000);
    scheduleNextBoss();
  }
}

function updateBoss() {
  if (!bossActive || !bossEl) return;

  const cx = bossX + 60;
  const cy = bossY + 60;
  const dx = x - cx;
  const dy = y - cy;
  const dist = Math.sqrt(dx * dx + dy * dy) || 1;
  const hpFactor = 1 - bossHp / bossMaxHp;
  const chase = 0.95 + hpFactor * 1.15;

  if (bossDashFrames > 0) {
    bossX += bossVx;
    bossY += bossVy;
    bossDashFrames--;
  } else {
    bossX += (dx / dist) * chase;
    bossY += (dy / dist) * chase;
    bossDashCooldown--;
    if (bossDashCooldown <= 0) {
      const dashSpeed = 5.2 + hpFactor * 1.2;
      bossVx = (dx / dist) * dashSpeed;
      bossVy = (dy / dist) * dashSpeed;
      bossDashFrames = 22;
      bossDashCooldown = 140 - Math.floor(hpFactor * 45);
      spawnBossBullet();
    }
  }

  bossX = Math.max(0, Math.min(window.innerWidth - 120, bossX));
  bossY = Math.max(0, Math.min(window.innerHeight - 120, bossY));
  bossEl.style.left = bossX + "px";
  bossEl.style.top = bossY + "px";

  if (!invincible && collide(player, bossEl)) death();
}

function collide(a, b) {
  const A = a.getBoundingClientRect();
  const B = b.getBoundingClientRect();
  return !(A.right < B.left || A.left > B.right || A.bottom < B.top || A.top > B.bottom);
}

function animeDeathBurst(xPos, yPos, parent) {
  const host = parent || game;
  const ring = document.createElement("div");
  ring.style.position = "absolute";
  ring.style.left = xPos + "px";
  ring.style.top = yPos + "px";
  ring.style.width = "20px";
  ring.style.height = "20px";
  ring.style.border = "2px solid rgba(255,145,191,0.95)";
  ring.style.borderRadius = "50%";
  ring.style.transform = "translate(-50%,-50%) scale(0.3)";
  ring.style.opacity = "1";
  ring.style.pointerEvents = "none";
  ring.style.zIndex = 10020;
  host.appendChild(ring);

  let ringScale = 0.3;
  let ringOpacity = 1;
  function animateRing() {
    ringScale += 0.18;
    ringOpacity -= 0.045;
    ring.style.transform = `translate(-50%,-50%) scale(${ringScale})`;
    ring.style.opacity = ringOpacity;
    if (ringOpacity > 0) requestAnimationFrame(animateRing);
    else ring.remove();
  }
  animateRing();

  for (let i = 0; i < 24; i++) {
    const particle = document.createElement("div");
    particle.style.position = "absolute";
    particle.style.left = xPos + "px";
    particle.style.top = yPos + "px";
    particle.style.width = (2 + Math.random() * 5) + "px";
    particle.style.height = (2 + Math.random() * 5) + "px";
    particle.style.borderRadius = "50%";
    particle.style.background = i % 4 === 0 ? "#fff" : "#ff7abf";
    particle.style.boxShadow = "0 0 12px rgba(255,122,191,0.95)";
    particle.style.pointerEvents = "none";
    particle.style.zIndex = 10021;
    host.appendChild(particle);
    const ang = Math.random() * Math.PI * 2;
    const ps = 4 + Math.random() * 6;
    let life = 1;
    let px = 0;
    let py = 0;

    function animateParticle() {
      px += Math.cos(ang) * ps;
      py += Math.sin(ang) * ps;
      life -= 0.04;
      particle.style.transform = `translate(${px}px,${py}px)`;
      particle.style.opacity = life;
      if (life > 0) requestAnimationFrame(animateParticle);
      else particle.remove();
    }
    animateParticle();
  }
}

function devitoCutscene() {
  if (cutsceneActive || gameOver) return;
  cutsceneActive = true;
  invincible = true;

  const overlay = document.createElement("div");
  overlay.className = "cutscene-overlay";
  overlay.style.position = "absolute";
  overlay.style.top = 0;
  overlay.style.left = 0;
  overlay.style.width = "100vw";
  overlay.style.height = "100vh";
  overlay.style.background = "radial-gradient(circle at center, rgba(62,18,31,0.72) 0%, rgba(0,0,0,0.94) 65%)";
  overlay.style.backdropFilter = "blur(3px) saturate(1.4)";
  overlay.style.zIndex = 10000;
  overlay.style.overflow = "hidden";
  overlay.style.opacity = "0";
  overlay.style.transition = "opacity 500ms ease";
  game.appendChild(overlay);

  const bloom = document.createElement("div");
  bloom.style.position = "absolute";
  bloom.style.inset = "0";
  bloom.style.background = "radial-gradient(circle at 50% 45%, rgba(255,212,235,0.32), rgba(0,0,0,0) 55%)";
  bloom.style.mixBlendMode = "screen";
  bloom.style.pointerEvents = "none";
  overlay.appendChild(bloom);

  const title = document.createElement("div");
  title.textContent = "DANNY DEVITO // BLOSSOM RONIN";
  title.style.position = "absolute";
  title.style.top = "15%";
  title.style.left = "50%";
  title.style.transform = "translate(-50%,-40px)";
  title.style.color = "#ffd3ec";
  title.style.fontFamily = "monospace";
  title.style.letterSpacing = "5px";
  title.style.fontSize = "20px";
  title.style.textShadow = "0 0 24px rgba(255,161,215,0.9)";
  title.style.opacity = "0";
  title.style.transition = "all 700ms ease";
  title.style.zIndex = 10004;
  overlay.appendChild(title);

  const devito = document.createElement("img");
  devito.src = "devito.jpeg";
  devito.style.width = "340px";
  devito.style.position = "absolute";
  devito.style.left = "50%";
  devito.style.top = "52%";
  devito.style.transform = "translate(-50%,-50%) scale(0.45) rotate(0deg)";
  devito.style.filter = "blur(6px) grayscale(0.4) brightness(0.85) drop-shadow(0 0 0 rgba(255,211,236,0.9))";
  devito.style.imageRendering = "pixelated";
  devito.style.transition = "all 1100ms cubic-bezier(.2,.75,.2,1)";
  devito.style.zIndex = 10003;
  overlay.appendChild(devito);

  const aura = document.createElement("div");
  aura.style.position = "absolute";
  aura.style.left = "50%";
  aura.style.top = "52%";
  aura.style.width = "380px";
  aura.style.height = "380px";
  aura.style.borderRadius = "50%";
  aura.style.transform = "translate(-50%,-50%) scale(0.45)";
  aura.style.background = "radial-gradient(circle, rgba(255,189,227,0.4) 0%, rgba(255,189,227,0) 70%)";
  aura.style.filter = "blur(12px)";
  aura.style.opacity = "0.25";
  aura.style.transition = "all 900ms ease";
  aura.style.zIndex = 10002;
  overlay.appendChild(aura);

  const whiteFlash = document.createElement("div");
  whiteFlash.style.position = "absolute";
  whiteFlash.style.inset = "0";
  whiteFlash.style.background = "#ffe9f5";
  whiteFlash.style.opacity = "0";
  whiteFlash.style.transition = "opacity 160ms ease";
  whiteFlash.style.zIndex = 10050;
  overlay.appendChild(whiteFlash);

  const petals = [];
  for (let i = 0; i < 120; i++) {
    const p = document.createElement("div");
    const size = 5 + Math.random() * 14;
    p.style.position = "absolute";
    p.style.width = size + "px";
    p.style.height = (size * 0.6) + "px";
    p.style.borderRadius = "80% 20% 70% 30%";
    p.style.background = i % 3 === 0 ? "#ffc7e4" : "#ff91c6";
    p.style.boxShadow = "0 0 12px rgba(255,165,215,0.6)";
    p.style.opacity = (0.25 + Math.random() * 0.75).toFixed(2);
    overlay.appendChild(p);
    petals.push({
      el: p,
      x: Math.random() * window.innerWidth,
      y: Math.random() * window.innerHeight - window.innerHeight,
      vx: (Math.random() - 0.5) * 1.8,
      vy: 1.2 + Math.random() * 3.4,
      rot: Math.random() * 360,
      rotV: (Math.random() - 0.5) * 6
    });
  }

  let shake = 0;
  function createSlash(angle, delay) {
    setTimeout(() => {
      const slash = document.createElement("div");
      slash.style.position = "absolute";
      slash.style.left = "50%";
      slash.style.top = "52%";
      slash.style.width = "12px";
      slash.style.height = "12px";
      slash.style.background = "linear-gradient(90deg, rgba(255,255,255,0.95), rgba(255,152,214,0.7), rgba(255,255,255,0.95))";
      slash.style.boxShadow = "0 0 45px rgba(255,170,228,1)";
      slash.style.transformOrigin = "center";
      slash.style.transform = `translate(-50%,-50%) rotate(${angle}deg) scale(0.2,0.35)`;
      slash.style.borderRadius = "999px";
      slash.style.transition = "transform 220ms cubic-bezier(.2,.7,.2,1), opacity 240ms ease";
      slash.style.zIndex = 10040;
      overlay.appendChild(slash);
      requestAnimationFrame(() => {
        slash.style.transform = `translate(-50%,-50%) rotate(${angle}deg) scale(26,0.36)`;
        slash.style.opacity = "0";
      });
      setTimeout(() => slash.remove(), 260);
      shake = 10;
      whiteFlash.style.opacity = "0.85";
      setTimeout(() => {
        whiteFlash.style.opacity = "0";
      }, 70);
    }, delay);
  }

  setTimeout(() => {
    overlay.style.opacity = "1";
  }, 20);
  setTimeout(() => {
    title.style.opacity = "1";
    title.style.transform = "translate(-50%,0)";
  }, 350);
  setTimeout(() => {
    devito.style.transform = "translate(-50%,-50%) scale(1.1) rotate(-8deg)";
    devito.style.filter = "blur(0px) grayscale(0) brightness(1.2) contrast(1.25) saturate(1.4) drop-shadow(0 0 35px rgba(255,219,240,0.95))";
    aura.style.transform = "translate(-50%,-50%) scale(1.45)";
    aura.style.opacity = "0.75";
  }, 900);

  createSlash(-24, 1750);
  createSlash(8, 1900);
  createSlash(34, 2050);
  createSlash(-14, 2200);
  createSlash(18, 2360);

  setTimeout(() => {
    document.querySelectorAll(".enemy").forEach(e => {
      const rect = e.getBoundingClientRect();
      animeDeathBurst(rect.left + rect.width / 2, rect.top + rect.height / 2, overlay);
      e.remove();
    });
  }, 2450);

  let last = performance.now();
  function animatePetals(now) {
    if (!cutsceneActive) return;
    const dt = Math.min(32, now - last) / 16;
    last = now;
    petals.forEach(p => {
      p.x += p.vx * dt + Math.sin((now + p.rot * 8) / 380) * 0.9;
      p.y += p.vy * dt;
      p.rot += p.rotV * dt;
      if (p.y > window.innerHeight + 30) {
        p.y = -20 - Math.random() * window.innerHeight * 0.4;
        p.x = Math.random() * window.innerWidth;
      }
      if (p.x < -30) p.x = window.innerWidth + 20;
      if (p.x > window.innerWidth + 30) p.x = -20;
      p.el.style.transform = `translate(${p.x}px,${p.y}px) rotate(${p.rot}deg)`;
    });
    overlay.style.transform = shake > 0 ? `translate(${(Math.random() - 0.5) * shake}px, ${(Math.random() - 0.5) * shake}px)` : "translate(0,0)";
    shake *= 0.88;
    requestAnimationFrame(animatePetals);
  }
  requestAnimationFrame(animatePetals);

  setTimeout(() => {
    title.style.opacity = "0";
    devito.style.opacity = "0";
    aura.style.opacity = "0";
    overlay.style.opacity = "0";
  }, 3300);

  setTimeout(() => {
    cutsceneActive = false;
    invincible = false;
    overlay.remove();
  }, 3900);
}

function kirk() {
  if (cutsceneActive || gameOver) return;
  cutsceneActive = true;
  invincible = true;
  score += 50;
  speed += 20;
  scoreEl.textContent = score;
  spdEl.textContent = speed.toFixed(1);

  const overlay = document.createElement("div");
  overlay.className = "cutscene-overlay";
  overlay.style.position = "absolute";
  overlay.style.top = 0;
  overlay.style.left = 0;
  overlay.style.width = "100vw";
  overlay.style.height = "100vh";
  overlay.style.zIndex = 10000;
  overlay.style.overflow = "hidden";
  overlay.style.opacity = "0";
  overlay.style.transition = "opacity 550ms ease";
  overlay.style.background = "linear-gradient(180deg, rgba(6,11,31,0.9) 0%, rgba(8,16,44,0.92) 55%, rgba(15,23,28,0.92) 100%)";
  game.appendChild(overlay);

  const moon = document.createElement("div");
  moon.style.position = "absolute";
  moon.style.top = "14%";
  moon.style.left = "73%";
  moon.style.width = "230px";
  moon.style.height = "230px";
  moon.style.borderRadius = "50%";
  moon.style.background = "radial-gradient(circle at 30% 30%, rgba(255,255,255,1), rgba(209,228,255,0.92) 45%, rgba(153,186,244,0.72) 70%, rgba(126,158,214,0.4) 100%)";
  moon.style.boxShadow = "0 0 85px rgba(192,224,255,0.9), 0 0 170px rgba(123,169,242,0.65)";
  moon.style.filter = "saturate(1.1)";
  moon.style.zIndex = 10002;
  overlay.appendChild(moon);

  const moonHaze = document.createElement("div");
  moonHaze.style.position = "absolute";
  moonHaze.style.inset = "0";
  moonHaze.style.background = "radial-gradient(circle at 73% 24%, rgba(185,217,255,0.22), rgba(0,0,0,0) 45%)";
  moonHaze.style.mixBlendMode = "screen";
  moonHaze.style.zIndex = 10001;
  overlay.appendChild(moonHaze);

  for (let i = 0; i < 5; i++) {
    const cloud = document.createElement("div");
    cloud.style.position = "absolute";
    cloud.style.width = (240 + Math.random() * 180) + "px";
    cloud.style.height = (56 + Math.random() * 40) + "px";
    cloud.style.top = (70 + Math.random() * 220) + "px";
    cloud.style.left = (-260 + Math.random() * window.innerWidth) + "px";
    cloud.style.borderRadius = "999px";
    cloud.style.background = "linear-gradient(90deg, rgba(88,113,159,0.28), rgba(138,166,214,0.32), rgba(88,113,159,0.24))";
    cloud.style.filter = "blur(9px)";
    cloud.style.opacity = (0.3 + Math.random() * 0.4).toFixed(2);
    cloud.style.zIndex = 10003;
    overlay.appendChild(cloud);
    const drift = 0.15 + Math.random() * 0.35;

    function moveCloud() {
      const xPos = parseFloat(cloud.style.left) + drift;
      cloud.style.left = (xPos > window.innerWidth + 40 ? -300 : xPos) + "px";
      if (cutsceneActive) requestAnimationFrame(moveCloud);
    }
    requestAnimationFrame(moveCloud);
  }

  const fog = document.createElement("div");
  fog.style.position = "absolute";
  fog.style.left = "0";
  fog.style.bottom = "0";
  fog.style.width = "100%";
  fog.style.height = "42%";
  fog.style.background = "linear-gradient(180deg, rgba(110,170,120,0) 0%, rgba(78,160,102,0.2) 35%, rgba(65,141,86,0.4) 65%, rgba(45,94,63,0.7) 100%)";
  fog.style.filter = "blur(3px)";
  fog.style.zIndex = 10006;
  overlay.appendChild(fog);

  const kirkImg = document.createElement("img");
  kirkImg.src = "kirk.jpeg";
  kirkImg.style.position = "absolute";
  kirkImg.style.left = "50%";
  kirkImg.style.top = "56%";
  kirkImg.style.width = "310px";
  kirkImg.style.transform = "translate(-50%,-50%) scale(0.72) rotate(0deg)";
  kirkImg.style.filter = "brightness(0.82) contrast(1.15) hue-rotate(96deg) drop-shadow(0 0 0 rgba(170,255,191,0.8))";
  kirkImg.style.transition = "all 950ms cubic-bezier(.2,.8,.2,1)";
  kirkImg.style.zIndex = 10009;
  overlay.appendChild(kirkImg);

  const title = document.createElement("div");
  title.textContent = "KIRK, MOONLIT NECROMANCER";
  title.style.position = "absolute";
  title.style.top = "12%";
  title.style.left = "50%";
  title.style.transform = "translate(-50%,-20px)";
  title.style.fontFamily = "monospace";
  title.style.fontSize = "22px";
  title.style.letterSpacing = "4px";
  title.style.color = "#b9ffd4";
  title.style.textShadow = "0 0 24px rgba(132,255,180,0.95)";
  title.style.opacity = "0";
  title.style.transition = "all 700ms ease";
  title.style.zIndex = 10010;
  overlay.appendChild(title);

  const sigil = document.createElement("div");
  sigil.style.position = "absolute";
  sigil.style.left = "50%";
  sigil.style.top = "66%";
  sigil.style.width = "360px";
  sigil.style.height = "360px";
  sigil.style.borderRadius = "50%";
  sigil.style.border = "2px solid rgba(133,255,184,0.5)";
  sigil.style.boxShadow = "0 0 45px rgba(113,250,166,0.5), inset 0 0 30px rgba(113,250,166,0.35)";
  sigil.style.transform = "translate(-50%,-50%) scale(0.65)";
  sigil.style.opacity = "0.15";
  sigil.style.zIndex = 10008;
  overlay.appendChild(sigil);

  const sigilInner = document.createElement("div");
  sigilInner.style.position = "absolute";
  sigilInner.style.left = "50%";
  sigilInner.style.top = "66%";
  sigilInner.style.width = "230px";
  sigilInner.style.height = "230px";
  sigilInner.style.borderRadius = "50%";
  sigilInner.style.border = "2px dashed rgba(184,255,218,0.52)";
  sigilInner.style.transform = "translate(-50%,-50%)";
  sigilInner.style.opacity = "0.35";
  sigilInner.style.zIndex = 10008;
  overlay.appendChild(sigilInner);

  const undead = [];
  for (let i = 0; i < 50; i++) {
    const e = document.createElement("div");
    e.className = "enemy";
    const ex = Math.random() * (window.innerWidth - 60) + 10;
    const ey = window.innerHeight - (40 + Math.random() * 90);
    e.style.left = ex + "px";
    e.style.top = ey + "px";
    e.style.opacity = "0";
    e.style.transform = "translateY(54px) scale(0.24)";
    e.style.transition = "transform 700ms cubic-bezier(.16,.84,.22,1), opacity 420ms ease, box-shadow 350ms ease";
    e.style.background = "linear-gradient(160deg, #5eff95, #1e6843)";
    e.style.boxShadow = "0 0 24px rgba(126,255,171,0.95)";
    e.style.borderRadius = "7px";
    e.style.zIndex = 9980;
    game.appendChild(e);
    undead.push({ el: e, x: ex, y: ey });

    setTimeout(() => {
      e.style.opacity = "1";
      e.style.transform = "translateY(0px) scale(1)";
      e.style.boxShadow = "0 0 16px rgba(108,255,160,0.8)";
      for (let j = 0; j < 9; j++) {
        const spark = document.createElement("div");
        spark.style.position = "absolute";
        spark.style.left = ex + 16 + "px";
        spark.style.top = ey + 16 + "px";
        spark.style.width = (2 + Math.random() * 4) + "px";
        spark.style.height = (2 + Math.random() * 4) + "px";
        spark.style.borderRadius = "50%";
        spark.style.background = "#bfffd7";
        spark.style.boxShadow = "0 0 10px rgba(187,255,214,0.95)";
        spark.style.zIndex = 10011;
        overlay.appendChild(spark);
        const ang = Math.random() * Math.PI * 2;
        const vel = 1.8 + Math.random() * 3.2;
        let life = 1;
        let px = 0;
        let py = 0;

        function fly() {
          px += Math.cos(ang) * vel;
          py += Math.sin(ang) * vel - 1.2;
          life -= 0.06;
          spark.style.transform = `translate(${px}px,${py}px)`;
          spark.style.opacity = life;
          if (life > 0) requestAnimationFrame(fly);
          else spark.remove();
        }
        fly();
      }
    }, 750 + Math.random() * 1300);
  }

  let glowPulse = 0;
  function animateNecro() {
    if (!cutsceneActive) return;
    glowPulse += 0.03;
    sigil.style.transform = `translate(-50%,-50%) scale(${0.95 + Math.sin(glowPulse) * 0.06}) rotate(${glowPulse * 20}deg)`;
    sigil.style.opacity = (0.16 + Math.sin(glowPulse * 2) * 0.09).toFixed(3);
    sigilInner.style.transform = `translate(-50%,-50%) rotate(${-glowPulse * 36}deg) scale(${1 + Math.cos(glowPulse * 1.4) * 0.05})`;
    kirkImg.style.transform = `translate(-50%,-50%) scale(${1.03 + Math.sin(glowPulse * 1.6) * 0.025}) rotate(${Math.sin(glowPulse * 1.1) * 2}deg)`;
    requestAnimationFrame(animateNecro);
  }
  requestAnimationFrame(animateNecro);

  setTimeout(() => {
    overlay.style.opacity = "1";
  }, 20);
  setTimeout(() => {
    title.style.opacity = "1";
    title.style.transform = "translate(-50%,0)";
    kirkImg.style.transform = "translate(-50%,-50%) scale(1.06) rotate(-1.5deg)";
    kirkImg.style.filter = "brightness(1.06) contrast(1.2) hue-rotate(104deg) drop-shadow(0 0 28px rgba(165,255,195,0.96))";
    sigil.style.opacity = "0.3";
  }, 420);

  setTimeout(() => {
    overlay.style.opacity = "0";
  }, 4300);

  setTimeout(() => {
    overlay.remove();
    undead.forEach(obj => {
      obj.el.style.zIndex = "";
      obj.el.style.background = "";
      obj.el.style.borderRadius = "6px";
      obj.el.style.transition = "";
      obj.el.style.transform = "";
      obj.el.style.opacity = "1";
    });
    cutsceneActive = false;
  }, 4900);

  setTimeout(() => {
    invincible = false;
  }, 5000);
}

function death() {
  gameOver = true;
  if (bossActive) endBossFight(false);
  clearTimers();
  player.style.opacity = "0";

  for (let i = 0; i < 60; i++) {
    const p = document.createElement("div");
    p.style.position = "absolute";
    p.style.width = "5px";
    p.style.height = "5px";
    p.style.background = "white";
    p.style.left = x + "px";
    p.style.top = y + "px";
    p.style.opacity = "1";
    game.appendChild(p);

    const ang = Math.random() * 2 * Math.PI;
    const v = 2 + Math.random() * 6;
    let px = 0;
    let py = 0;

    function anim() {
      px += Math.cos(ang) * v;
      py += Math.sin(ang) * v;
      p.style.transform = `translate(${px}px,${py}px)`;
      p.style.opacity = String(parseFloat(p.style.opacity) - 0.03);
      if (parseFloat(p.style.opacity) > 0) requestAnimationFrame(anim);
      else p.remove();
    }
    anim();
  }

  setTimeout(() => {
    playBtn.style.display = "block";
  }, 500);
}

function loop() {
  if (gameOver) return;
  if (cutsceneActive) {
    requestAnimationFrame(loop);
    return;
  }

  if (keys["ArrowUp"] || keys["w"]) velY -= acceleration;
  if (keys["ArrowDown"] || keys["s"]) velY += acceleration;
  if (keys["ArrowLeft"] || keys["a"]) velX -= acceleration;
  if (keys["ArrowRight"] || keys["d"]) velX += acceleration;

  let mag = Math.sqrt(velX * velX + velY * velY);
  if (mag > speed) {
    velX = (velX / mag) * speed;
    velY = (velY / mag) * speed;
  }

  velX *= friction;
  velY *= friction;
  x += velX;
  y += velY;

  if (x > window.innerWidth) x = 0;
  if (x < 0) x = window.innerWidth;
  if (y > window.innerHeight) y = 0;
  if (y < 0) y = window.innerHeight;

  player.style.left = x + "px";
  player.style.top = y + "px";

  if (!bossActive && !cutsceneActive) {
    if (Date.now() >= nextBossAt) {
      startBossFight();
    }
  }

  updateBoss();

  document.querySelectorAll(".boss-bullet").forEach(b => {
    const vx = parseFloat(b.dataset.vx || "0");
    const vy = parseFloat(b.dataset.vy || "0");
    const bx = parseFloat(b.style.left) + vx;
    const by = parseFloat(b.style.top) + vy;
    b.style.left = bx + "px";
    b.style.top = by + "px";

    if (bx < -30 || by < -30 || bx > window.innerWidth + 30 || by > window.innerHeight + 30) {
      b.remove();
      return;
    }
    if (!invincible && collide(player, b)) death();
  });

  document.querySelectorAll(".enemy").forEach(e => {
    let ex = parseFloat(e.style.left);
    let ey = parseFloat(e.style.top);
    const dx = x - ex;
    const dy = y - ey;
    const dist = Math.sqrt(dx * dx + dy * dy) || 1;
    ex += (dx / dist) * enemySpeed;
    ey += (dy / dist) * enemySpeed;
    e.style.left = ex + "px";
    e.style.top = ey + "px";
    if (!invincible && collide(player, e)) death();
  });

  document.querySelectorAll(".orb").forEach(o => {
    if (collide(player, o)) {
      o.remove();
      score++;
      speed += 0.6;
      enemySpeed += 0.03;
      scoreEl.textContent = score;
      spdEl.textContent = speed.toFixed(1);
      if (bossActive) {
        bossHp -= 1;
        updateBossUI();
        if (bossHp <= 0) kirkFinisherCutscene();
      }
      spawn("orb");
    }
  });

  document.querySelectorAll(".power").forEach(p => {
    if (collide(player, p)) {
      p.remove();
      devitoCutscene();
    }
  });

  document.querySelectorAll(".kirk").forEach(k => {
    if (collide(player, k)) {
      k.remove();
      kirk();
    }
  });

  requestAnimationFrame(loop);
}

function startGame() {
  if (gameStarted) return;
  gameStarted = true;
  startScreen.style.display = "none";
  game.style.display = "block";
  resetState();
  spawn("orb");
  startTimers();
  game.focus();
  requestAnimationFrame(loop);
}

startO.addEventListener("click", () => {
  localStorage.setItem(INTRO_KEY, "1");
  startGame();
});

if (localStorage.getItem(INTRO_KEY) === "1") {
  startGame();
}
</script>
</body>
</html>
